{"version":3,"file":"js/686.5f521528.js","mappings":"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","sources":["webpack://ton-token-bridge/./src/utils/providers/walletLink/index.ts","webpack://ton-token-bridge/./node_modules/nanoevents/index.js"],"sourcesContent":["import { createNanoEvents, Emitter } from \"nanoevents\";\nimport Web3 from \"web3\";\n\n// import { WalletLink as WalletLinkProvider } from 'walletlink';\nimport { PARAMS } from \"@/utils/constants\";\nimport { parseChainId } from \"@/utils/helpers\";\nimport { getScript } from \"@/utils/helpers\";\n\nimport { Provider } from \"../provider\";\n\ninterface Events {\n  disconnect: () => void;\n}\n\nexport class WalletLink implements Provider {\n  public name = \"walletLink\";\n  public title = \"WalletLink\";\n  public web3: Web3 | null = null;\n  public myAddress = \"\";\n  public chainId = 0;\n  public isConnected = false;\n  private provider: any = null;\n  private emitter: Emitter;\n\n  constructor() {\n    this.emitter = createNanoEvents<Events>();\n    this.onAccountsChanged = this.onAccountsChanged.bind(this);\n    this.onChainChanged = this.onChainChanged.bind(this);\n    this.onDisconnect = this.onDisconnect.bind(this);\n    this.onConnect = this.onConnect.bind(this);\n  }\n\n  on<E extends keyof Events>(event: E, callback: Events[E]) {\n    return this.emitter.on(event, callback);\n  }\n\n  async connect(params: any): Promise<boolean> {\n    if (window.ethereum && window.ethereum.isCoinbaseWallet === true) {\n      this.provider = window.ethereum;\n    } else {\n      try {\n        await getScript(\"walletLink@2.4.2.js\");\n      } catch (err: any) {\n        console.log(err.message);\n        return false;\n      }\n\n      const walletLink = new window.WalletLinkBundle.default({\n        appName: PARAMS.appName,\n        appLogoUrl: PARAMS.appLogoUrl,\n        darkMode: false,\n      });\n      this.provider = walletLink.makeWeb3Provider(\n        params.rpcEndpoint,\n        params.chainId\n      );\n    }\n\n    try {\n      await this.provider!.enable();\n    } catch (e: any) {\n      console.log(e.message);\n      if (e.message === \"User denied account authorization\") {\n        // soft error: User rejected the request.\n        console.log(e.message);\n        return false;\n      }\n      throw new Error(e.message);\n    }\n\n    this.web3 = new Web3(this.provider!);\n\n    const accounts = await this.web3.eth.getAccounts();\n    this.myAddress = accounts[0];\n\n    this.chainId = parseChainId(await this.web3.eth.net.getId());\n\n    if (this.chainId !== params.chainId) {\n      await this.switchChain(params.chainId);\n    }\n\n    this.isConnected = true;\n\n    this.provider!.on(\"accountsChanged\", this.onAccountsChanged);\n    this.provider!.on(\"chainChanged\", this.onChainChanged);\n    this.provider!.on(\"disconnect\", this.onDisconnect);\n    this.provider!.on(\"connect\", this.onConnect);\n\n    return true;\n  }\n\n  onAccountsChanged(accounts: Array<string>) {\n    console.log(\"account changed, old address: \", this.myAddress);\n    if (accounts && accounts.length) {\n      this.myAddress = accounts[0];\n    } else {\n      this.myAddress = \"\";\n    }\n    console.log(\"account changed, new address: \", this.myAddress);\n  }\n\n  onChainChanged(chainId: number | string) {\n    console.log(\"chain changed, old chain: \", this.chainId);\n    this.chainId = parseChainId(chainId);\n    console.log(\"chain changed, new chain: \", this.chainId);\n  }\n\n  onDisconnect(code: number, reason: string) {\n    this.isConnected = false;\n    console.log(\"disconnected\");\n\n    this.provider!.off(\"accountsChanged\", this.onAccountsChanged);\n    this.provider!.off(\"chainChanged\", this.onChainChanged);\n    this.provider!.off(\"disconnect\", this.onDisconnect);\n    this.provider!.off(\"connect\", this.onConnect);\n\n    this.emitter.emit(\"disconnect\");\n    this.emitter.events = {};\n  }\n\n  onConnect() {\n    this.isConnected = true;\n    console.log(\"connected\");\n  }\n\n  async switchChain(chainId: number): Promise<boolean> {\n    try {\n      await this.provider.request({\n        method: \"wallet_switchEthereumChain\",\n        params: [{ chainId: \"0x\" + chainId.toString(16) }],\n      });\n    } catch (e: any) {\n      console.log(e.message);\n      return false;\n    }\n    return true;\n  }\n\n  disconnect() {\n    this.provider.close();\n  }\n}\n","export let createNanoEvents = () => ({\n  events: {},\n  emit(event, ...args) {\n    let callbacks = this.events[event] || []\n    for (let i = 0, length = callbacks.length; i < length; i++) {\n      callbacks[i](...args)\n    }\n  },\n  on(event, cb) {\n    this.events[event]?.push(cb) || (this.events[event] = [cb])\n    return () => {\n      this.events[event] = this.events[event]?.filter(i => cb !== i)\n    }\n  }\n})\n"],"names":["WalletLink","constructor","this","emitter","createNanoEvents","onAccountsChanged","bind","onChainChanged","onDisconnect","onConnect","on","event","callback","async","params","window","ethereum","isCoinbaseWallet","provider","getScript","err","console","log","message","walletLink","WalletLinkBundle","default","appName","PARAMS","appLogoUrl","darkMode","makeWeb3Provider","rpcEndpoint","chainId","enable","e","Error","web3","Web3","accounts","eth","getAccounts","myAddress","parseChainId","net","getId","switchChain","isConnected","length","code","reason","off","emit","events","request","method","toString","disconnect","close","args","callbacks","i","cb","push","filter"],"sourceRoot":""}